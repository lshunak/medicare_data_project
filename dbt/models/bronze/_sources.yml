version: 2

sources:
  - name: medicare_raw
    database: medicare_raw_db
    schema: bronze
    description: "Raw Medicare claims and enrollment data loaded from CMS source files as external tables"
    tables:
      - name: beneficiaries
        description: "Contains information about Medicare beneficiaries."
        columns:
          - name: bene_id
            description: "Unique identifier for each Medicare beneficiary"
            tests:
              - unique
              - not_null
      
      - name: claims
        description: "All Medicare claims across different service types (carrier, inpatient, outpatient, etc.). Each record represents a single claim."
        columns:
          - name: clm_id
            description: "Unique identifier for each claim"
            tests:
              - unique
              - not_null
          - name: bene_id
            description: "Identifier for each Medicare beneficiary. Foreign key to beneficiaries table."
            tests:
              - not_null
              - relationships:
                  to: ref('medicare_raw', 'beneficiaries')
                  field: bene_id
          - name: clm_type_cd
            description: "{{ doc('claim_type_codes') }}"
            tests:
              - not_null
              - accepted_values:
                  values: [
                    'CAR',     # Carrier claims
                    'INP',     # Inpatient
                    'OUT',     # Outpatient
                    'DME',     # Durable Medical Equipment
                    'HHA',     # Home Health Agency
                    'HSP',     # Hospice
                    'SNF'      # Skilled Nursing Facility
                  ]
      - name: pde
        description: "Part D Prescription Drug Events. Each record represents a prescription drug fill or refill."
        columns:
          - name: pde_id
            description: "Unique identifier for each prescription drug event"
            tests:
              - unique
              - not_null
          - name: bene_id
            description: "Identifier for each Medicare beneficiary. Foreign key to beneficiaries table."
            tests:
              - not_null
              - relationships:
                  to: ref('medicare_raw', 'beneficiaries')
                  field: bene_id